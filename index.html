<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Form Pengajuan Layanan ‚Äî Mobil Layanan Umat (Mobile)</title>
<meta name="description" content="Form pengajuan layanan Mobil Layanan Umat PCM Wonotunggal. Mobile-first, kirim via WhatsApp."/>
<style>
  :root{
    --bg:#ffffff;
    --muted:#6b7580;
    --accent-orange:#ff8a4b;
    --accent-blue:#1273de;
    --field-bg:#f6fbff;
    --radius:12px;
    --shadow: 0 12px 30px rgba(6,24,48,0.08);
    font-family: Inter, 'Segoe UI', monttserrat, system-ui, -apple-system, 'Helvetica Neue', Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:#072138;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:12px}
  .wrap{width:100%;max-width:640px}

  /* HERO (blue solid, left-aligned text, logo right) */
  .hero{
    width:100%; border-radius:12px; overflow:hidden; background:var(--accent-blue);
    height:24vh; min-height:110px; max-height:200px; display:flex; align-items:center; padding:16px; position:relative; box-shadow:var(--shadow)
  }
  .hero-left{flex:1;color:#fff; align-self:center; text-align:left}
  .hero-left .small{font-size:13px;font-weight:800;opacity:0.98}
  .hero-left .big{font-size:22px;font-weight:900; margin-top:6px}
  .hero-left .sub{font-size:14px;margin-top:8px;font-weight:700;opacity:0.95}
  .hero-right{position:absolute; right:12px; top:12px}
  .hero-right img{width:56px;height:56px;object-fit:contain;border-radius:8px;background:#fff;padding:6px;box-shadow:0 10px 28px rgba(2,6,23,0.12)}

  /* card */
  .card{margin-top:-18px;background:#fff;border-radius:12px;padding:14px;width:100%;box-shadow:0 12px 36px rgba(6,24,48,0.06);display:grid;gap:12px}

  /* fields */
  .field{display:flex;gap:12px;align-items:flex-start;padding:14px;border-radius:14px;background:var(--field-bg);border:1px solid rgba(18,115,222,0.08);transition:box-shadow .12s, transform .12s}
  .field:focus-within{box-shadow:0 14px 30px rgba(18,115,222,0.08);transform:translateY(-2px);border-color:rgba(18,115,222,0.18)}
  .icon{width:44px;height:44px;border-radius:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.45)}
  .icon svg{width:22px;height:22px}
  .control{flex:1}
  label{display:block;font-size:14px;color:#0b2b3a;font-weight:800;margin-bottom:8px}
  input[type=text], input[type=tel], input[type=number], input[type=date], input[type=time], select, textarea{
    width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(11,43,58,0.06);background:#fff;font-size:16px;color:#072138;outline:none;
  }
  textarea{min-height:100px;resize:vertical}
  input::placeholder, textarea::placeholder{color:#9aa4b2}
  .muted{color:var(--muted);font-size:14px}

  /* category / dynamic select */
  .inline-row{display:flex;gap:8px}
  .inline-row .col{flex:1}

  /* buttons */
  .actions{display:flex;gap:10px;margin-top:8px}
  .btn{padding:14px;border-radius:12px;border:none;font-weight:900;cursor:pointer;font-size:15px}
  .btn-primary{flex:1;background:linear-gradient(90deg,var(--accent-orange),var(--accent-blue));color:#fff;box-shadow:0 12px 26px rgba(18,115,222,0.12)}
  .btn-ghost{background:#fff;border:1px solid rgba(11,43,58,0.06);color:var(--muted);padding:12px 14px;border-radius:12px}

  /* popup */
  .popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:120;padding:12px}
  .popup.show{display:flex}
  .modal{width:100%;max-width:540px;background:#fff;border-radius:12px;padding:16px;box-shadow:0 24px 60px rgba(2,6,23,0.28)}
  .summary{margin-top:10px;background:rgba(18,115,222,0.04);padding:12px;border-radius:8px;font-size:15px;color:#07324a}

  /* toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:#f0fff4;border-left:6px solid #28a745;padding:12px 14px;border-radius:10px;display:none;z-index:130;font-weight:800}
  .toast.show{display:block}

  /* footer */
  footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  .sponsors{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;justify-items:center;align-items:center;margin-top:8px}
  .sponsor-slot{width:86px;height:40px;border-radius:8px;background:#fff;border:1px dashed rgba(11,43,58,0.04);display:flex;align-items:center;justify-content:center}
  .sponsor-slot img{max-width:84px;max-height:36px;object-fit:contain}

  /* Mobile-friendly tweaks */
  @media (max-width:420px){
    body{padding:10px}
    .hero{height:20vh;padding:12px}
    .hero-left .big{font-size:18px}
    .icon{width:44px;height:44px}
    .field{padding:12px;gap:10px;border-radius:12px}
    label{font-size:13px}
    input,select,textarea{font-size:15px;padding:11px 12px}
    .btn{font-size:15px;padding:12px;border-radius:12px}
    .hero-right img{width:48px;height:48px}
    .sponsors{grid-template-columns:repeat(3,1fr);gap:6px}
    .summary{font-size:14px}
    .card{padding:12px;gap:10px}
  }

  @media (min-width:1024px){
    .wrap{max-width:820px}
  }
</style>
</head>
<body>
  <div class="wrap">

    <!-- HERO -->
    <header class="hero" role="banner" aria-label="Header">
      <div class="hero-left">
        <div class="small">FORM PENGAJUAN LAYANAN</div>
        <div class="big">MOBIL LAYANAN UMAT</div>
        <div class="sub">Pimpinan Cabang Muhammadiyah Wonotunggal</div>
      </div>
      <div class="hero-right" aria-hidden="true">
        <!-- placeholder generic header logo -->
        <img src="logo-header-placeholder.png" alt="Logo MLU">
      </div>
    </header>

    <!-- FORM -->
    <main class="card" role="main">
      <form id="mluForm" autocomplete="on" novalidate>
        <!-- tanggal -->
        <div class="field">
          <div class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M8 7V3M16 7V3M3 11h18" /></svg>
          </div>
          <div class="control">
            <label for="tanggal">Tanggal</label>
            <input id="tanggal" name="tanggal" type="date" required>
          </div>
        </div>

        <!-- hari (below date) -->
        <div class="field">
          <div class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="#ff8a4b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/></svg>
          </div>
          <div class="control">
            <label for="hariDisplay">Hari (otomatis)</label>
            <input id="hariDisplay" name="hariDisplay" type="text" readonly placeholder="Akan muncul setelah pilih tanggal">
          </div>
        </div>

        <!-- Nama Pemohon -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><circle cx="12" cy="7" r="4"/><path d="M4 21v-2a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v2"/></svg></div>
          <div class="control">
            <label for="pemohon">Nama Pemohon</label>
            <input id="pemohon" name="pemohon" type="text" placeholder="" required>
          </div>
        </div>

        <!-- No HP -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><path d="M22 16.92V21a1 1 0 0 1-1.11 1A19 19 0 0 1 3 4.11"/></svg></div>
          <div class="control">
            <label for="hp">No. HP</label>
            <input id="hp" name="hp" type="tel" inputmode="tel" placeholder="Contoh: 081234567890" required>
          </div>
        </div>

        <!-- Nama Pasien -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#ff8a4b" stroke-width="1.6"><circle cx="12" cy="8" r="3"/></svg></div>
          <div class="control">
            <label for="pasien">Nama Pasien</label>
            <input id="pasien" name="pasien" type="text" placeholder="" required>
          </div>
        </div>

        <!-- Usia -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><path d="M12 2v6"/><path d="M5 22h14"/></svg></div>
          <div class="control">
            <label for="usia">Usia Pasien</label>
            <input id="usia" name="usia" type="number" min="0" placeholder="tahun" required>
          </div>
        </div>

        <!-- Alamat jemput -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><path d="M21 10c0 6-9 12-9 12S3 16 3 10a9 9 0 0 1 18 0z"/></svg></div>
          <div class="control">
            <label for="alamat">Alamat jemput</label>
            <textarea id="alamat" name="alamat" placeholder="Contoh: Jl. Merdeka No.12, Desa A RT 01 RW 01" required></textarea>
          </div>
        </div>

        <!-- Tujuan: kategori + dynamic -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#ff8a4b" stroke-width="1.6"><path d="M21 10l-9 9-9-9"/></svg></div>
          <div class="control">
            <label for="kategoriTujuan">Kategori Tujuan</label>
            <div class="inline-row">
              <div class="col">
                <select id="kategoriTujuan" name="kategoriTujuan">
                  <option value="Rumah Sakit">Rumah Sakit</option>
                  <option value="Puskesmas">Puskesmas</option>
                  <option value="Klinik / Praktek Dokter">Klinik / Praktek Dokter</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- dynamic target select -->
        <div class="field" id="tujuanField">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><path d="M12 2v20"/></svg></div>
          <div class="control">
            <label id="tujuanLabel" for="tujuanSelect">Tempat tujuan</label>
            <select id="tujuanSelect" name="tujuanSelect"></select>
            <input id="tujuanManual" name="tujuanManual" type="text" placeholder="Tulis tujuan jika memilih Lainnya atau Klinik (opsional)" style="display:none;margin-top:8px;">
          </div>
        </div>

        <!-- Jam & Tiba -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><circle cx="12" cy="12" r="9"/></svg></div>
          <div class="control">
            <label for="jam">Jam berangkat</label>
            <input id="jam" name="jam" type="time" required>
            <div style="height:8px"></div>
            <label for="tiba" class="muted">Tiba ditujuan (Jam brapa harus sampai)</label>
            <input id="tiba" name="tiba" type="time">
          </div>
        </div>

        <!-- Jenis penyakit (wajib) -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><path d="M21 8V7a2 2 0 0 0-2-2h-3"/></svg></div>
          <div class="control">
            <label for="penyakit">Jenis penyakit</label>
            <input id="penyakit" name="penyakit" type="text" placeholder="Contoh: demam / sesak napas" required>
          </div>
        </div>

        <!-- Posisi & Pendamping -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#ff8a4b" stroke-width="1.6"><path d="M3 12h18"/></svg></div>
          <div class="control">
            <label for="posisi">Posisi pasien</label>
            <select id="posisi" name="posisi"><option value="Duduk">Duduk</option><option value="Baring">Baring</option></select>
            <div style="height:8px"></div>
            <label for="pendamping" class="muted">Jumlah Pendamping</label>
            <input id="pendamping" name="pendamping" type="number" min="0" placeholder="Contoh: 1">
          </div>
        </div>

        <!-- Keterangan -->
        <div class="field">
          <div class="icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#1273de" stroke-width="1.6"><path d="M21 15v4a1 1 0 0 1-1 1H9l-6-6V5"/></svg></div>
          <div class="control">
            <label for="keterangan">Keterangan (opsional)</label>
            <textarea id="keterangan" name="keterangan" placeholder="Opsional: rute, kebutuhan khusus (butuh Oksigen), catatan untuk driver"></textarea>
          </div>
        </div>

        <div class="actions">
<div class="field" style="margin-top:12px">
  <div class="control">
    <label style="font-size:14px">
      <input type="checkbox" id="persetujuan" required>
      Saya memahami dan bersedia mengikuti pedoman layanan yang berlaku.
    </label>
    <div style="margin-top:6px;font-size:13px">
      <a href="s.id/gowosopo" target="_blank">
        üìÑ Baca Pedoman Layanan
      </a>
    </div>
  </div>
</div>
          <button type="button" id="openConfirm" class="btn btn-primary">Kirim & Hubungi Admin</button>
          <button type="button" id="resetBtn" class="btn btn-ghost">Reset</button>
        </div>
      </form>
    </main>

    <!-- Confirm popup -->
    <div class="popup" id="confirmPopup" role="dialog" aria-modal="true">
      <div class="modal">
        <h3>Konfirmasi Pengajuan</h3>
        <p class="muted" style="margin-top:6px">Periksa kembali data. Pilih "Yakin & Kirim" bila sudah benar.</p>
        <div class="summary" id="confirmSummary" aria-live="polite"></div>
 	<div style="margin-top:10px;font-size:13px;color:#555;line-height:1.5">
      üü¢ <strong>Informasi:</strong><br>
      Setelah klik <strong>‚ÄúYakin & Kirim‚Äù</strong>, whatsapp akan terbuka otomatis.
      Silakan klik <strong>Kirim</strong> di WhatsApp untuk menyelesaikan pengajuan layanan.
    </div>

        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:10px">
          <button id="confirmEdit" class="btn btn-ghost">üîÑ Cek Lagi</button>
          <button id="confirmSend" class="btn btn-primary">‚úÖ Yakin & Kirim</button>
        </div>
      </div>
    </div>

    <div class="toast" id="successToast">‚úÖ Pengajuan Anda berhasil dikirim! Admin akan menghubungi Anda.</div>

    <!-- footer sponsors -->
    <footer>
      <div style="font-weight:800">Didukung oleh:</div>
      <div class="sponsors">
        <div class="sponsor-slot"><img src="logo-sponsor-1.png" alt="Sponsor 1"></div>
        <div class="sponsor-slot"><img src="logo-sponsor-2.png" alt="Sponsor 2"></div>
        <div class="sponsor-slot"><img src="logo-sponsor-3.png" alt="Sponsor 3"></div>
        <div class="sponsor-slot"><img src="logo-sponsor-4.png" alt="Sponsor 4"></div>
        <div class="sponsor-slot"><img src="logo-sponsor-5.png" alt="Sponsor 5"></div>
        <div class="sponsor-slot"><img src="logo-sponsor-6.png" alt="Sponsor 6"></div>
      </div>
      <div style="margin-top:8px;color:var(--muted);font-size:12px">¬© PCM Wonotunggal ‚Ä¢ Mobil Layanan Umat</div>
    </footer>

  </div>

<script>
  // CONFIG
  const ADMIN_PHONE = '6285117803676'; // 085117803676 (hidden in UI)
  const FORM_ENDPOINT ='https://script.google.com/macros/s/AKfycbxAnZtJ4OuXa1HIREfJEh9i7RjGYtwhaqke19KmFr1hMvv8XKg_SNVufhXIpkAuLm2a/exec'; // optional: Google Apps Script URL to store entries

  // ===============================
  // DATABASE TUJUAN (update terbaru)
  // ===============================

  const RS_LIST = [
    'RS QIM Batang',
    'RSUD Batang',
    'RSUP Karyadi Semarang',
    'RSO Soeharso Solo',
    'RSI Pekajangan',
    'RS Bendan Pekalongan',
    'RS ARO Pekalongan',
    'RS Siti Khotijah Pekalongan',
    'RS Kraton Pekalongan',
    'RS Hermina Pekalongan'
  ];

  const PUSKESMAS_LIST = [
    'Puskesmas Wonotunggal',
    'Rumah Bersalin Wonotunggal',
    'Puskesmas Bandar 1'
  ];

  const KLINIK_LIST = [
    'Klinik Sidayu Medical Center Bandar',
    'Klinik Anugrah Husada Bandar',
    'Praktek Dokter Dody Bandar',
    'Praktek Dokter Broto Warungasem',
    'Praktek Dokter Nurbaah Batang',
    'Praktek Dokter Andirio Batang',
    'Praktek Dokter Ibrahim Batang'
  ];

  // ===============================
  // DOM & FUNGSI FORM
  // ===============================

  const kategoriTujuan = document.getElementById('kategoriTujuan');
  const tujuanSelect = document.getElementById('tujuanSelect');
  const tujuanManual = document.getElementById('tujuanManual');
  const tujuanLabel = document.getElementById('tujuanLabel');
  const tanggal = document.getElementById('tanggal');
  const hariDisplay = document.getElementById('hariDisplay');

  const form = document.getElementById('mluForm');
  const openConfirm = document.getElementById('openConfirm');
  const resetBtn = document.getElementById('resetBtn');
  const confirmPopup = document.getElementById('confirmPopup');
  const confirmSummary = document.getElementById('confirmSummary');
  const confirmEdit = document.getElementById('confirmEdit');
  const confirmSend = document.getElementById('confirmSend');
  const successToast = document.getElementById('successToast');

  const DAYS = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
  const MONTHS = ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];

  function formatDateDisplay(dateObj){
    const d = dateObj.getDate();
    const m = MONTHS[dateObj.getMonth()];
    const y = dateObj.getFullYear();
    return `${d} ${m} ${y}`;
  }
  function getDayName(dateObj){ return DAYS[dateObj.getDay()]; }

  // populate tujuan select based on category
  function populateTujuan(category){
    tujuanSelect.innerHTML = '';
    tujuanManual.style.display = 'none';
    if(category === 'Rumah Sakit'){
      tujuanLabel.textContent = 'Pilih Rumah Sakit';
      RS_LIST.forEach(r => { const opt = document.createElement('option'); opt.value = r; opt.textContent = r; tujuanSelect.appendChild(opt); });
    } else if(category === 'Puskesmas'){
    const optLabel = document.createElement('option');
    optLabel.disabled = true;
    optLabel.textContent = 'Daftar Puskesmas';
    tujuanSelect.appendChild(optLabel);
      tujuanLabel.textContent = 'Pilih Puskesmas';
      PUSKESMAS_LIST.forEach(r => { const opt = document.createElement('option'); opt.value = r; opt.textContent = r; tujuanSelect.appendChild(opt); });
    } else if(category === 'Klinik / Praktek Dokter' || category === 'Klinik'){
      tujuanLabel.textContent = 'Pilih Klinik / Praktek Dokter';
      KLINIK_LIST.forEach(r => { const opt = document.createElement('option'); opt.value = r; opt.textContent = r; tujuanSelect.appendChild(opt); });
    } else {
      tujuanLabel.textContent = 'Tujuan (tulis manual)';
      tujuanSelect.style.display = 'none';
      tujuanManual.style.display = 'block';
      return;
    }

    // tambahkan opsi "Lainnya"
    const other = document.createElement('option');
    other.value = 'Lainnya';
    other.textContent = 'Lainnya (tulis manual)';
    tujuanSelect.appendChild(other);
    tujuanSelect.style.display = 'block';
  }

  // inisialisasi default
  populateTujuan(kategoriTujuan.value);

  kategoriTujuan.addEventListener('change', (e) => {
    if (e.target.value === 'Lainnya') {
      tujuanSelect.style.display = 'none';
      tujuanManual.style.display = 'block';
    } else {
      populateTujuan(e.target.value);
      tujuanManual.style.display = 'none';
    }
  });

  tujuanSelect.addEventListener('change', (e) => {
    if(e.target.value === 'Lainnya'){
      tujuanManual.style.display = 'block';
    } else {
      tujuanManual.style.display = 'none';
    }
  });

  // tanggal -> hari otomatis
  tanggal.addEventListener('change', ()=>{
    if(tanggal.value){
      const dt = new Date(tanggal.value + 'T00:00:00');
      hariDisplay.value = getDayName(dt);
    } else { hariDisplay.value = ''; }
  });

  function buildPayload(){
    const data = new FormData(form);
    let tglText = data.get('tanggal') || '';
    let dayText = '-';
    let dateFormatted = tglText;
    if(tglText){
      const dt = new Date(tglText + 'T00:00:00');
      dayText = getDayName(dt);
      dateFormatted = formatDateDisplay(dt);
    }
    // determine final tujuan text
    let tujuanVal = data.get('tujuanSelect') || '';
    const manual = data.get('tujuanManual') || '';
    if(tujuanVal === 'Lainnya' && manual) tujuanVal = manual;
    else if(!tujuanVal && manual) tujuanVal = manual;

    return {
      hari: dayText,
      tanggal: dateFormatted,
      pemohon: data.get('pemohon') || '-',
      pasien: data.get('pasien') || '-',
      usia: data.get('usia') || '-',
      hp: data.get('hp') || '-',
      alamat: data.get('alamat') || '-',
      tujuan: tujuanVal || '-',
      jam: data.get('jam') || '-',
      tiba: data.get('tiba') || '-',
      penyakit: data.get('penyakit') || '-',
      posisi: data.get('posisi') || '-',
      pendamping: data.get('pendamping') || '-',
      keterangan: data.get('keterangan') || '-'
    };
  }

  // confirm flow
  openConfirm.addEventListener('click', ()=>{
  if (!document.getElementById('persetujuan').checked) {
    alert('Mohon menyetujui ketentuan layanan terlebih dahulu.');
    return;
  }
    const required = ['pemohon','pasien','usia','hp','alamat','tanggal','jam','penyakit'];
    for(const id of required){
      const el = document.getElementById(id);
      if(!el || !el.value){
        el && el.focus();
        alert('Mohon lengkapi semua kolom yang wajib (termasuk jenis penyakit).');
        return;
      }
    }
    const payload = buildPayload();

    confirmSummary.innerHTML = `
      <strong>Hari:</strong> ${payload.hari} <br>
      <strong>Tanggal:</strong> ${payload.tanggal} <br><br>
      <strong>Nama Pemohon:</strong> ${payload.pemohon} <br>
      <strong>Nama Pasien:</strong> ${payload.pasien} (Usia: ${payload.usia}) <br>
      <strong>No. HP:</strong> ${payload.hp} <br>
      <strong>Alamat Jemput:</strong> ${payload.alamat} <br>
      <strong>Tujuan:</strong> ${payload.tujuan} <br>
      <strong>Jam Berangkat:</strong> ${payload.jam} &nbsp;&nbsp;
      <strong>Tiba:</strong> ${payload.tiba} <br>
      <strong>Jenis Penyakit:</strong> ${payload.penyakit} <br>
      <strong>Posisi:</strong> ${payload.posisi} &nbsp;&nbsp;
      <strong>Pendamping:</strong> ${payload.pendamping} <br>
      <strong>Keterangan:</strong> ${payload.keterangan ? payload.keterangan : '-'} `;
    confirmPopup.classList.add('show');
  });

  confirmEdit.addEventListener('click', ()=>{ confirmPopup.classList.remove('show'); });

  confirmSend.addEventListener('click', async () => {
  let noReg = '(diproses sistem)';

  confirmSend.disabled = true;
  confirmSend.textContent = 'Mengirim...';

  const payload = buildPayload();

  // =============================
  // 1Ô∏è‚É£ BUKA WHATSAPP (WAJIB PERTAMA)
  // =============================
  const lines = [
    '*FORM PERMOHONAN LAYANAN*',
    '*Mobil Layanan Umat Pimpinan Cabang Muhammadiyah (PCM) Wonotunggal.*',
    '',
    '*[LAYANAN PASIEN]*',
    '',
    `No. Registrasi : ${noReg}`,
    '--------------------------------',
    `Hari : ${payload.hari}`,
    `Tanggal : ${payload.tanggal}`,
    '',
    '*Mohon diisi untuk ketertiban administrasi*',
    `1. Nama Pemohon : ${payload.pemohon}`,
    `2. Nama Pasien : ${payload.pasien}`,
    `3. Usia: ${payload.usia} th`,
    `4. No. HP : ${payload.hp}`,
    `5. Alamat jemput : ${payload.alamat}`,
    `6. Tempat tujuan : ${payload.tujuan}`,
    `7. Jam berangkat : ${payload.jam}`,
    `8. Tiba ditujuan : ${payload.tiba}`,
    `9. Jenis penyakit : ${payload.penyakit}`,
    `10. Posisi pasien : ${payload.posisi}`,
    `11. Jumlah Pendamping : ${payload.pendamping}`,
    `12. Keterangan : ${payload.keterangan || '-'}`,
    '',
    '*Untuk layanan luar kota dimohon mengirimkan bukti pendaftaran Rumah Sakit Tujuan | Jangan Lupa Pakai Maskerüò∑*'
  ];

  const waText = encodeURIComponent(lines.join('\n'));
  const waUrl = `https://wa.me/${ADMIN_PHONE}?text=${waText}`;
  window.open(waUrl, '_blank'); // ‚¨ÖÔ∏è INI KUNCI UTAMA

  // =============================
  // 2Ô∏è‚É£ KIRIM KE GOOGLE SHEET (BACKGROUND)
  // =============================
  if (FORM_ENDPOINT) {
    const fd = new FormData(form);
    fd.append('tujuan', payload.tujuan);
    fd.append('hari', payload.hari);
    fd.append('tanggal_formatted', payload.tanggal);

    fetch(FORM_ENDPOINT, {
      method: 'POST',
      body: fd
    })
    .then(res => res.json())
    .then(result => console.log('No Reg:', result.reg))
    .catch(err => console.warn(err));
  }

  // =============================
  // 3Ô∏è‚É£ TUTUP POPUP & RESET
  // =============================
  confirmPopup.classList.remove('show');
  showToast();
  form.reset();
  hariDisplay.value = '';
  populateTujuan(kategoriTujuan.value);

  confirmSend.disabled = false;
  confirmSend.textContent = '‚úÖ Yakin & Kirim';
  });

  resetBtn.addEventListener('click', ()=>{ if(confirm('Reset semua field?')){ form.reset(); hariDisplay.value=''; populateTujuan(kategoriTujuan.value); } });

  function showToast(){ const t = document.getElementById('successToast'); t.classList.add('show'); setTimeout(()=> t.classList.remove('show'),6000); }

  // accessibility
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') confirmPopup.classList.remove('show'); });
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const lembaga = document.getElementById("lembaga");
  const box = document.getElementById("lembagaManualBox");
  const input = document.getElementById("lembaga_manual");

  lembaga.addEventListener("change", function () {
    if (this.value === "lainnya") {
      box.style.display = "block";
      input.required = true;
    } else {
      box.style.display = "none";
      input.required = false;
      input.value = "";
    }
  });
});
</script>
</body>
</html>
